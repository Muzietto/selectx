!function(r){var t,n,i,p;t=function(){this._defaults={selectOne:!1,selectOnce:!1,selectionsContainer:null,templateEngine:!1,optionIds:!1,log:function(){return!1},flagChosenOption:"chosenOption",templateHtml:String()+'<div class="selectx-option-widget">\t<input type="hidden" class="selectx-option-hidden-value" value="">\t<label class="selectx-option-value" style="width:200px;min-height:18px;display:inline-block;"></label>\t<button class="selectx-delete-widget" title="click to delete widget">delete</button></div>',optionWidgetDataModel:{value:"dummy label"},optionsList:[{text:"1st option",value:1,data:null},{text:"2nd option",value:2,data:null},{text:"3rd option",value:3,data:null}],nullOptionMessage:"pick one",onSelectCallback:null,onUnselectCallback:null,constrainedValues:null}},r.extend(t.prototype,{markerClassName:"hasSelectX",pluginName:"selectx",selectionsClassName:"selectx-selections-container",selectedOptionClass:"selectx-selected-option",optionWidgetClass:"selectx-option-widget",optionValueClass:"selectx-option-value",optionHiddenValueClass:"selectx-option-hidden-value",deleteWidgetClass:"selectx-delete-widget",optionWidgetContainerClass:"selectx-option-widget-container",setDefaults:function(t){return r.extend(this._defaults,t||{}),this},_attachPlugin:function(t,e){var n,i=r(t);if(!i.hasClass(this.markerClassName))return n={options:r.extend({},this._defaults),selectionsContainer:r([])},i.addClass(this.markerClassName).data(this.pluginName,n).bind("change."+this.pluginName,function(){p._changeSelect(r(this),n.options)}),this._optionPlugin(t,e),this},_optionPlugin:function(t,n,e){var i=r(t),a=i.data(this.pluginName),s=this;if(!n||"string"==typeof n&&null==e){var o=n;return(n=(a||{}).options)&&o?n[o]:n}if(i.hasClass(this.markerClassName)){if("string"==typeof(n=n||{})){o=n;(n={})[o]=e}if(r.extend(a.options,n),void 0!==e)return this;if(r.isFunction(a.options.selectionsContainer)?a.selectionsContainer=a.options.selectionsContainer.apply(t[0],[]):a.options.selectionsContainer?a.selectionsContainer=r(a.options.selectionsContainer):a.selectionsContainer=r("<div/>").insertAfter(i),a.selectionsContainer.addClass(this.selectionsClassName),0===r("option",i).length){var l=!1;i.append(r("<option/>",{text:a.options.nullOptionMessage,value:""})),_(a.options.optionsList).each(function(t){if(t.text&&t.value){var e=r("<option/>",t);a.options.optionIds&&e.attr("id",i.attr("id")+"."+t.value),t&&t.data&&e.data(s.pluginName+"-optiondata",t.data),i.append(e),t.data&&t.data[n.flagChosenOption||p._defaults.flagChosenOption]&&(p._changeSelect(i,n,e),l=!0)}}),a.options.selectOne&&l&&r("option",i).attr("disabled","disabled")}return this}},_destroyPlugin:function(t,e){var n,i=r(t);return!!i.hasClass(this.markerClassName)&&(((n=r(t).data("selectx").options).selectOne||n.selectOnce)&&this._resetPlugin(i),i.next(".selectx-selections-container").remove(),i.removeClass(this.markerClassName).removeData(this.pluginName).unbind("."+this.pluginName),e||r("option",i).remove(),this)},_resetPlugin:function(t){if((t=r(t)).hasClass(this.markerClassName))return t.data(this.pluginName),r("option",t).attr("disabled",!1),this},_changeSelect:function(e,n,t){var i,a,s,o,l,p,d=e.data(this.pluginName),c=this;s=t||r(":selected",e),p=s.data(c.pluginName+"-optiondata"),i=r("<div/>").addClass(this.optionWidgetContainerClass),n.templateEngine?(l=r.isFunction(d.options.optionWidgetDataModel)?d.options.optionWidgetDataModel(p):d.options.optionWidgetDataModel,d.options.optionIds&&(l.id=s.attr("id")+"_widget"),i.setTemplate(n.templateHtml).processTemplate(l),a=r("."+this.optionWidgetClass,i),d.selectionsContainer.append(i.append(a))):(a=r(n.templateHtml),d.selectionsContainer.append(i.append(a)),r("."+this.optionValueClass,a).text(s.text()),r("."+this.optionHiddenValueClass,a).val(s.val())),(o=r("."+this.deleteWidgetClass,a)).data(this.pluginName+"-option",s),o.click(function(t){n.selectOne?c._resetPlugin(e):n.selectOnce&&r(this).data(c.pluginName+"-option").removeAttr("disabled"),p&&p.locator&&delete p.locator,n.onUnselectCallback&&n.onUnselectCallback.apply(a),i.remove()}),s.data(c.pluginName+"-optiondata")&&a.data(c.pluginName+"-optiondata",s.data(c.pluginName+"-optiondata")),n.selectOne?r("option",e).attr("disabled","disabled"):n.selectOnce&&s.attr("disabled","disabled"),n.onSelectCallback&&n.onSelectCallback.apply(a),e.val("")},_chosenDataPlugin:function(t){var n=[],i=this;return r("."+this.optionWidgetClass,r(t).next("."+this.selectionsClassName)).each(function(t,e){r(e).data(i.pluginName+"-optiondata")&&n.push(r(e).data(i.pluginName+"-optiondata"))}),n},_bitmaskPlugin:function(t){var n=0;return r("option",r(t)).each(function(t,e){0<r(e).parent("span").length&&(n+=Math.pow(2,t))}),n},log:function(t){this.options.logger&&this.options.logger.log("SelectX: "+t)}}),n=["chosenData","bitmask"],i=function(t,e){return"option"==t&&(0==e.length||1==e.length&&"string"==typeof e[0])||-1<r.inArray(t,n)},r.fn.selectx=function(t){var e=Array.prototype.slice.call(arguments,1);return i(t,e)?p["_"+t+"Plugin"].apply(p,[this[0]].concat(e)):this.each(function(){if("string"==typeof t){if(!p["_"+t+"Plugin"])throw"Unknown method: "+t;p["_"+t+"Plugin"].apply(p,[this].concat(e))}else p._attachPlugin(this,t||{})})},p=r.selectx=new t}(jQuery);
